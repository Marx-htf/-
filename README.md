# 管网平差小程序
## 1. 制作背景：
给水管网平差是每个给排水学生都必须掌握的重点。所以老师一般都会布置一次简单的作业要求平差，学生一般用excel进行辅助计算。但是之后在课程设计中就会加大管网规模，excel就适应性不强就凸现了出来。

一般用python进行二次开发可以使用开源的epanet，第三方库也有很多例如wntr，epanet2。但作者对自己实现这个小程序有着深深的迷恋。
作者找遍全网，管网平差的纯python代码少，视频教程就更少（唯一的epanet教程好像还是YouTube上操着一口西班牙语的大叔讲的）。所以为了本专业的师弟师妹们不再和我一样找遍全网，故将程序分享。也希望有能力的同学在这个程序的基础上展现更高超的技术与智慧。

## 2. 功能：
init_input.py主要是用来输入管网节点编号列表、节点流量列表、管段列表（两端节点列表表示）、管段长度列表。所有的元素应当在列表的对应位置。第一个节点流量为负，表示水厂输入水至管网当中。管段列表当中应当是小节点编号在前，大节点编号在后。

pingcha.py主要是用来对init_input.py文件中的数据进行处理，通过numpy当中的np.linalg.lstsq得出初始流量，准备在back_cal.py当中进行哈代克罗斯法迭代求解管段流量。另外在文件中用算法求出所有环路。算法的原理近乎暴力。首先遍历搜索出所有始、终两点的路径。再判断始、终两点是否直接连接，若是，则成环保留，反之舍去路径。

back_cal.py主要用来哈代克罗斯法迭代，输出结果，并计算程序运行时间。

运用此程序，应先在init_input.py仿照格式填写出管网特征，保存。之后可双击运行back_cal.py，也可在python自带的IDLE下运行。

值得注意的是当有deadlink时，应把支状部分简化到最近的环路节点上。

（具体功能在注释里很详细，如有疑问可在我的[个人主页](https://marx-htf.github.io/)找到我的联系方式,也可通过我的[博客园](https://www.cnblogs.com/w-netboy/p/12074683.html)联系我）
